@model IEnumerable<ComputerStore.Shared.DTOs.ProductDto>
@{
    ViewData["Title"] = "Каталог товаров";
    var categories = ViewBag.Categories as IEnumerable<ComputerStore.Shared.DTOs.CategoryDto>;
    var currentSort = ViewBag.CurrentSort as string ?? "name";
    var categoryId = ViewBag.CategoryId as int?;
    var searchTerm = ViewBag.SearchTerm as string;
}

<div class="container py-4">
    <div class="row">
        <!-- Sidebar with categories -->
        <div class="col-lg-3">
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Категории</h5>
                </div>
                <div class="list-group list-group-flush">
                    <a asp-controller="Products" asp-action="Index"
                       class="list-group-item list-group-item-action @(categoryId == null ? "active" : "")">
                        Все товары
                    </a>
                    @if (categories != null)
                    {
                        @foreach (var category in categories)
                        {
                            <a asp-controller="Products" asp-action="Index" asp-route-categoryId="@category.Id"
                               class="list-group-item list-group-item-action @(categoryId == category.Id ? "active" : "")">
                                @category.Name
                                <span class="badge bg-secondary float-end">@category.ProductCount</span>
                            </a>
                        }
                    }
                </div>
            </div>
        </div>

        <!-- Products -->
        <div class="col-lg-9">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2>@(ViewBag.CategoryName ?? "Все товары")</h2>
                    @if (!string.IsNullOrEmpty(searchTerm))
                    {
                        <p class="text-muted mb-0">Результаты поиска для: "@searchTerm"</p>
                    }
                </div>

                <!-- Sort dropdown -->
                <div class="dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle" type="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                        Сортировка
                    </button>
                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item @(currentSort == "name" ? "active" : "")"
                               asp-route-categoryId="@categoryId" asp-route-search="@searchTerm" asp-route-sort="name">
                                По названию
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item @(currentSort == "price_asc" ? "active" : "")"
                               asp-route-categoryId="@categoryId" asp-route-search="@searchTerm" asp-route-sort="price_asc">
                                Сначала дешёвые
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item @(currentSort == "price_desc" ? "active" : "")"
                               asp-route-categoryId="@categoryId" asp-route-search="@searchTerm" asp-route-sort="price_desc">
                                Сначала дорогие
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item @(currentSort == "rating" ? "active" : "")"
                               asp-route-categoryId="@categoryId" asp-route-search="@searchTerm" asp-route-sort="rating">
                                По рейтингу
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item @(currentSort == "newest" ? "active" : "")"
                               asp-route-categoryId="@categoryId" asp-route-search="@searchTerm" asp-route-sort="newest">
                                Новинки
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Products grid -->
            @if (Model.Any())
            {
                <div class="row g-4">
                    @foreach (var product in Model)
                    {
                        <div class="col-md-6 col-lg-4">
                            <partial name="_ProductCard" model="product" />
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="alert alert-info">
                    <h4>Товары не найдены</h4>
                    <p>Попробуйте изменить параметры поиска или выбрать другую категорию.</p>
                    <a asp-action="Index" class="btn btn-primary">Посмотреть все товары</a>
                </div>
            }
        </div>
    </div>
</div>
